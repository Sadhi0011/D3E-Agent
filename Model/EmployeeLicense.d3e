(Model EmployeeLicense {
    name 'Employee License'
    master #Employee
    allowDynamicReport true
    package 'rewahr.com'
    properties [
        (issuedDate {
            name 'Issued Date'
            type ({
                primitive Date
            })
        })
        (expiryDate {
            name 'Expiry Date'
            type ({
                primitive Date
            })
        })
        (licenseNumber {
            name 'License Number'
            type ({
                primitive String
            })
        })
        (licenseType {
            name 'LicenseType'
            type ({
                model #License
            })
            required true
            referenceFrom `this.employee.company.licenses`
        })
    ]
    actions [
        (saveAuditRecordOnCreate {
            runOn OnCreate
            block ```
                List<String> changes = [
                    EmployeeUtil.getChangedStringForNewField('Issued Date', issuedDate),
                    EmployeeUtil.getChangedStringForNewField('Expiry Date', expiryDate),
                    EmployeeUtil.getChangedStringForNewField('License Number', licenseNumber),
                    if (licenseType != null)
                        EmployeeUtil.getChangedStringForNewField('License Type', licenseType.name),
                ].where((x) => x != null);

                if (changes.isNotEmpty) {
                    EmployeeUtil.addAuditRecord(
                        company: employee.company,
                        action: 'ADD LICENSE DETAILS -I',
                        employee: employee,
                        section: 'Qualification',
                        actionDescription: changes.join('\n'),
                    );
                }
            ```
        })
        (saveAuditRecordOnUpdate {
            runOn OnUpdate
            block ```
                if (old == null) {
                    return;
                }

                List<String> changes = [
                    EmployeeUtil.getChangedFromStringFromObjects('Issued Date', old.issuedDate, issuedDate),
                    EmployeeUtil.getChangedFromStringFromObjects('Expiry Date', old.expiryDate, expiryDate),
                    EmployeeUtil.getChangedFromString('License Number', old.licenseNumber, licenseNumber),
                    EmployeeUtil.getChangedFromString('License Type', old.licenseType == null ? '' : old.licenseType.name, licenseType == null ? '' : licenseType.name),
                ].where((x) => x != null);

                if (changes.isNotEmpty) {
                    EmployeeUtil.addAuditRecord(
                        company: employee.company,
                        action: 'UPDATE LICENSE DETAILS -U',
                        employee: employee,
                        section: 'Qualification',
                        actionDescription: changes.join('\n'),
                    );
                }
            ```
        })
        (deleteAuditRecordOnDelete {
            runOn OnDelete
            block ```
                EmployeeUtil.addAuditRecord(
                    company: employee.company,
                    action: 'DELETE LANGUAGE DETAILS',
                    employee: employee,
                    section: 'Qualification',
                    actionDescription: [
                        issuedDate.toString(),
                        expiryDate.toString(),
                        licenseNumber,
                        if (licenseType != null)
                            licenseType.name,
                    ].join('\n'),
                );
            ```
        })
    ]
})