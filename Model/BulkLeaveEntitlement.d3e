Model {
    package 'rewa.hr.2'
    name 'Bulk Leave Entitlement'
    master Company
    properties [
        {
            name 'Leave Type'
            type LeaveType
            required true
            referenceFrom `company.leaveTypes`
        }
        {
            name 'Comment'
            type String
        }
        {
            name 'Entitlements'
            type Double
            required true
        }
        {
            name 'Leave Period'
            type LeavePeriod
            required true
            referenceFrom `company.leavePeriods`
        }
        {
            name 'Entitlement Type'
            type String
        }
        {
            name 'Employees'
            collection true
            type Employee
        }
        {
            name 'Employee'
            type Employee
            existsIf `!addToMultiple`
        }
        {
            name 'Add To Multiple'
            type Boolean
        }
        {
            name 'Location'
            type Location
        }
        {
            name 'Sub Unit'
            type SubUnit
        }
    ]
    actions [
        {
            name 'AddLeaveEntitlement'
            block ```
                if(this.addToMultiple){
                    for(Employee emp in this.employees){
                        LeaveEntitlement entitlement = LeaveEntitlement(
                            company : company,
                            employee : emp,
                            leaveType : leaveType,
                            leavePeriod : leavePeriod,
                            entitlements : entitlements,
                            comment : comment,
                            entitlementType : entitlementType,
                            validFrom : leavePeriod.startDate,
                            validTo : leavePeriod.endDate
                        );
                        Database.save(entitlement);
                    }
                }else {
                    LeaveEntitlement entitlement = LeaveEntitlement(
                        company : company,
                        employee : employee,
                        leaveType : leaveType,
                        leavePeriod : leavePeriod,
                        entitlements : entitlements,
                        comment : comment,
                        entitlementType : entitlementType,
                        validFrom : leavePeriod.startDate,
                        validTo : leavePeriod.endDate,
                    );
                    Database.save(entitlement);
                }
            ```
        }
    ]
    transient true
}