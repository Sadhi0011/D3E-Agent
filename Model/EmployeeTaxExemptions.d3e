(Model EmployeeTaxExemptions {
    name 'Employee Tax Exemptions'
    
    master #Employee
    package 'rewahr.com'
    enableCustomFields true
    properties [
        (federalIncomeTaxStatus {
            name 'Federal Income Tax Status'
            type ({
                optionSet #TaxStatus
            })
        })
        (federalIncomeTaxExemptions {
            name 'Federal Income Tax Exemptions'
            type ({
                primitive Double
            })
        })
        (state {
            name 'State'
            type ({
                optionSet #USState
            })
        })
        (stateIncomeTaxStatus {
            name 'State Income Tax Status'
            type ({
                optionSet #TaxStatus
            })
        })
        (stateIncomeTaxExemptions {
            name 'State Income Tax Exemptions'
            type ({
                primitive Double
            })
        })
        (unemployementState {
            name 'Unemployement State'
            type ({
                optionSet #USState
            })
        })
        (workState {
            name 'Work State'
            type ({
                optionSet #USState
            })
        })
        (attachments{
            type ({
                model #Attachment
            })
            collection true
            inverse true
            inverseProperty #taxExemption
        })
    ]
    actions [
        (saveAuditRecordOnCreate {
            runOn OnCreate
            block ```
                List<String> changes = [
                    EmployeeUtil.getChangedStringForNewField('Federal Income Tax Status', federalIncomeTaxStatus.name),
                    EmployeeUtil.getChangedStringForNewField('Federal Income Tax Exceptions', federalIncomeTaxExemptions),
                    EmployeeUtil.getChangedStringForNewField('State', state.name),
                    EmployeeUtil.getChangedStringForNewField('State Income Tax Status', stateIncomeTaxStatus.name),
                    EmployeeUtil.getChangedStringForNewField('State Income Tax Exemptions', stateIncomeTaxExemptions),
                    EmployeeUtil.getChangedStringForNewField('Unemployement State', unemployementState.name),
                    EmployeeUtil.getChangedStringForNewField('Work State', workState.name),
                ].where((x) => x != null);

                if (changes.isNotEmpty) {
                    EmployeeUtil.addAuditRecord(
                        company: employee.company,
                        action: 'ADD TAX EXEMPTION DETAILS -I',
                        employee: employee,
                        section: 'Tax Exemptions',
                        actionDescription: changes.join('\n'),
                    );
                }
            ```
        })
        (saveAuditRecordOnUpdate {
            runOn OnUpdate
            block ```
                if (old == null) {
                    return;
                }

                List<String> changes = [
                    EmployeeUtil.getChangedFromString('Federal Income Tax Status', old.federalIncomeTaxStatus.name, federalIncomeTaxStatus.name),
                    EmployeeUtil.getChangedFromStringFromObjects('Federal Income Tax Exceptions', old.federalIncomeTaxExemptions, federalIncomeTaxExemptions),
                    EmployeeUtil.getChangedFromString('State', old.state.name, state.name),
                    EmployeeUtil.getChangedFromString('State Income Tax Status', old.stateIncomeTaxStatus.name, stateIncomeTaxStatus.name),
                    EmployeeUtil.getChangedFromStringFromObjects('State Income Tax Exemptions',old.stateIncomeTaxExemptions, stateIncomeTaxExemptions),
                    EmployeeUtil.getChangedFromString('Unemployement State', old.unemployementState.name, unemployementState.name),
                    EmployeeUtil.getChangedFromString('Work State', old.workState.name, workState.name),
                ].where((x) => x != null);

                if (changes.isNotEmpty) {
                    EmployeeUtil.addAuditRecord(
                        company: employee.company,
                        action: 'UPDATE TAX EXEMPTION DETAILS -U',
                        employee: employee,
                        section: 'Tax Exemptions',
                        actionDescription: changes.join('\n'),
                    );
                }
            ```
        })
    ]
})